(function(u){var A={parent:null},x=new (function(){var k=function(a){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");document.body.appendChild(this.canvas);this.width=this.canvas.width=a.width;this.height=this.canvas.height=a.height;this.context.drawImage(a,0,0,this.width,this.height)};k.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};k.prototype.update=function(a){this.context.putImageData(a,0,0)};k.prototype.getPixelCount=function(){return this.width*
this.height};k.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};k.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var e=function(){};if(e.prototype.getColor=function(a,c){return this.getPalette(a,5,c)[0]},e.prototype.getPalette=function(a,c,v){"undefined"==typeof c&&(c=10);"undefined"==typeof v&&(v=10);var m,y,e,p;a=new k(a);for(var t=a.getImageData().data,r=a.getPixelCount(),w=[],d=0;r>d;d+=v)m=4*d,y=t[m+0],e=t[m+1],
p=t[m+2],m=t[m+3],125<=m&&(250<y&&250<e&&250<p||w.push([y,e,p]));c=u.quantize(w,c).palette();return a.removeCanvas(),c},!p)var p={map:function(a,c){var v={};return c?a.map(function(a,e){return v.index=e,c.call(v,a)}):a.slice()},naturalOrder:function(a,c){return c>a?-1:a>c?1:0},sum:function(a,c){var e={};return a.reduce(c?function(a,p,k){return e.index=k,a+c.call(e,p)}:function(a,c){return a+c},0)},max:function(a,c){return Math.max.apply(null,c?p.map(a,c):a)}};var u=function(){function a(d,b,h){return(d<<
2*t)+(b<<t)+h}function c(d){function b(){h.sort(d);a=!0}var h=[],a=!1;return{push:function(b){h.push(b);a=!1},peek:function(d){return a||b(),void 0===d&&(d=h.length-1),h[d]},pop:function(){return a||b(),h.pop()},size:function(){return h.length},map:function(b){return h.map(b)},debug:function(){return a||b(),h}}}function e(d,b,a,q,l,f,g){this.r1=d;this.r2=b;this.g1=a;this.g2=q;this.b1=l;this.b2=f;this.histo=g}function m(){this.vboxes=new c(function(d,b){return p.naturalOrder(d.vbox.count()*d.vbox.volume(),
b.vbox.count()*b.vbox.volume())})}function k(d){var b,h,q,l,f=Array(1<<3*t);return d.forEach(function(d){h=d[0]>>r;q=d[1]>>r;l=d[2]>>r;b=a(h,q,l);f[b]=(f[b]||0)+1}),f}function u(d,b){var a,q,l,f=1E6,g=0,z=1E6,c=0,n=1E6,p=0;return d.forEach(function(b){a=b[0]>>r;q=b[1]>>r;l=b[2]>>r;f>a?f=a:a>g&&(g=a);z>q?z=q:q>c&&(c=q);n>l?n=l:l>p&&(p=l)}),new e(f,g,z,c,n,p,b)}function x(d,b){function h(d){var a,h,c,e=d+"1",f=d+"2";h=0;for(g=b[e];g<=b[f];g++)if(k[g]>s/2){d=b.copy();c=b.copy();a=g-b[e];h=b[f]-g;for(a=
h>=a?Math.min(b[f]-1,~~(g+h/2)):Math.max(b[e],~~(g-1-a/2));!k[a];)a++;for(h=r[a];!h&&k[a-1];)h=r[--a];return d[f]=a,c[e]=d[f]+1,[d,c]}}if(b.count()){var q=b.r2-b.r1+1,l=b.g2-b.g1+1,f=p.max([q,l,b.b2-b.b1+1]);if(1==b.count())return[b.copy()];var g,c,e,n,m,s=0,k=[],r=[];if(f==q)for(g=b.r1;g<=b.r2;g++){n=0;for(c=b.g1;c<=b.g2;c++)for(e=b.b1;e<=b.b2;e++)m=a(g,c,e),n+=d[m]||0;s+=n;k[g]=s}else if(f==l)for(g=b.g1;g<=b.g2;g++){n=0;for(c=b.r1;c<=b.r2;c++)for(e=b.b1;e<=b.b2;e++)m=a(c,g,e),n+=d[m]||0;s+=n;k[g]=
s}else for(g=b.b1;g<=b.b2;g++){n=0;for(c=b.r1;c<=b.r2;c++)for(e=b.g1;e<=b.g2;e++)m=a(c,e,g),n+=d[m]||0;s+=n;k[g]=s}return k.forEach(function(b,d){r[d]=s-b}),f==q?h("r"):f==l?h("g"):h("b")}}var t=5,r=8-t,w=1E3;return e.prototype={volume:function(d){return(!this._volume||d)&&(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(d){var b=this.histo;if(!this._count_set||d){var h,c,e=0;for(d=this.r1;d<=this.r2;d++)for(h=this.g1;h<=this.g2;h++)for(c=this.b1;c<=
this.b2;c++)index=a(d,h,c),e+=b[index]||0;this._count=e;this._count_set=!0}return this._count},copy:function(){return new e(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(d){var b=this.histo;if(!this._avg||d){var c,e,l,f=0,g=1<<8-t,k=0,m=0,n=0;for(d=this.r1;d<=this.r2;d++)for(e=this.g1;e<=this.g2;e++)for(l=this.b1;l<=this.b2;l++)c=a(d,e,l),c=b[c]||0,f+=c,k+=c*(d+0.5)*g,m+=c*(e+0.5)*g,n+=c*(l+0.5)*g;this._avg=f?[~~(k/f),~~(m/f),~~(n/f)]:[~~(g*(this.r1+this.r2+1)/2),~~(g*
(this.g1+this.g2+1)/2),~~(g*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(d){var b=d[0]>>r;return gval=d[1]>>r,bval=d[2]>>r,b>=this.r1&&b<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},m.prototype={push:function(d){this.vboxes.push({vbox:d,color:d.avg()})},palette:function(){return this.vboxes.map(function(d){return d.color})},size:function(){return this.vboxes.size()},map:function(d){for(var b=this.vboxes,a=0;a<b.size();a++)if(b.peek(a).vbox.contains(d))return b.peek(a).color;
return this.nearest(d)},nearest:function(a){for(var b,c,e,l=this.vboxes,f=0;f<l.size();f++)c=Math.sqrt(Math.pow(a[0]-l.peek(f).color[0],2)+Math.pow(a[1]-l.peek(f).color[1],2)+Math.pow(a[2]-l.peek(f).color[2],2)),(b>c||void 0===b)&&(b=c,e=l.peek(f).color);return e},forcebw:function(){var a=this.vboxes;a.sort(function(a,b){return p.naturalOrder(p.sum(a.color),p.sum(b.color))});var b=a[0].color;5>b[0]&&5>b[1]&&5>b[2]&&(a[0].color=[0,0,0]);var b=a.length-1,c=a[b].color;251<c[0]&&251<c[1]&&251<c[2]&&(a[b].color=
[255,255,255])}},{quantize:function(a,b){function e(a,b){for(var c,d=1,g=0;w>g;)if(c=a.pop(),c.count()){var f=x(q,c),h=f[0],f=f[1];if(!h)break;if(a.push(h),f&&(a.push(f),d++),d>=b)break;if(g++>w)break}else a.push(c),g++}if(!a.length||2>b||256<b)return!1;var q=k(a),l=0;q.forEach(function(){l++});var f=u(a,q),g=new c(function(a,b){return p.naturalOrder(a.count(),b.count())});g.push(f);e(g,0.75*b);for(f=new c(function(a,b){return p.naturalOrder(a.count()*a.volume(),b.count()*b.volume())});g.size();)f.push(g.pop());
e(f,b-f.size());for(g=new m;f.size();)g.push(f.pop());return g}}}();return e}()),B=function(k){var e=document.createElement("a");e.href=k;return!(e.hostname===location.hostname&&e.protocol===location.protocol&&e.port===location.port)};u.adaptiveBackground={run:function(k){var e=u.extend({},A,k);u(e.parent).find("img").each(function(k,A){var a=u(this);if(B(a.attr("src")))console.log("Not processing remote image: "+a.attr("src"));else{var c=function(){var c=function(a){return"rgb("+a.join(",")+")"},
e=c(x.getColor(a[0])),k=x.getPalette(a[0]).map(function(a){return c(a)});a.attr("data-ab-color",e);a.trigger("ab-color-found",{color:e,palette:k})};a.on("ab-color-found",function(c,k){(a.attr("data-ab-parent")?a.parents(a.attr("data-ab-parent")):e.parent?a.parents(e.parent):a.parent()).css({backgroundColor:k.color})});a[0].complete?c():a.load(c)}})}}})(jQuery);
